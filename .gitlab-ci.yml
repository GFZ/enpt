before_script:
  - git lfs pull

test_enpt:
  script:
    - source /root/anaconda3/bin/activate
    - export GDAL_DATA=/root/anaconda3/share/gdal
    - export PYTHONPATH=$PYTHONPATH:/root  # /root <- here are the sicor tables
    - make lint
    - make nosetests  # test are called here
    - make docs
  artifacts:
    paths:
    - htmlcov/
    - docs/_build/html/
    - nosetests.html
    - nosetests.xml
    - tests/linting


test_enpt_install:
  script:
    - source /root/anaconda3/bin/activate
    - conda create -y -q --name enpt python=3.5
    - source activate enpt
    # install sicor and geomultisens
    - conda install -y -q -c anaconda hdf5 pytables
    - conda install -y -q -c conda-forge gdal pygrib h5py
    - conda install -y -q -c numba llvmlite
    - conda install -y -q -c conda-forge psycopg2
    - git clone https://gitext.gfz-potsdam.de/EnMAP/sicor.git
    - git clone https://gitext.gfz-potsdam.de/danschef/GeoMultiSens.git
    - cd sicor
    - make install
    - cd ../GeoMultiSens
    - python setup.py install
    - cd ..
    # install enpt
    - make install
    - cd ..
    - pwd
    - ls
    - python -c "import enpt; print(enpt)"
    - python -c "from enpt.model.images import EnMAPL1Product_ImGeo"


pages:
  stage: deploy
  dependencies:
    - test_enpt
  script:
    - mkdir -p public/coverage
    - cp -r htmlcov/* public/coverage/
    - mkdir -p public/doc
    - cp -r docs/_build/html/* public/doc/
    - mkdir -p public/linting
    - cp tests/linting/*.log public/linting
  artifacts:
    paths:
      - public
    expire_in: 600 days
