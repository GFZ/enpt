FROM ci_base_centos:0.1

RUN yum update -y && \
    yum install -y texlive

# copy some needed stuff to /root
COPY *.yml /root/

# update the ci_env environment (that already contains all packages installed via 'docker_pyenvs' repo)
RUN /bin/bash -i -c "\
    source /root/miniconda3/bin/activate ; \
    conda update -n base -c conda-forge conda;\
    source activate ci_env; \
    conda env update -n ci_env -f /root/environment_enpt.yml"

# copy sicor code to /tmp
COPY sicor /tmp/sicor

# install sicor (in pip development mode so that its root directory in /tmp/sicor matching with the subsequent COPY command)
RUN bash -i -c "\
    source /root/miniconda3/bin/activate ci_env; \
    cd /tmp/sicor/ ; \
    pip install -e . ; \
    git lfs pull"
